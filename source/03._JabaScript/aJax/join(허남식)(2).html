<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>회원가입</title>
	<link href="join_css/join.css" rel="stylesheet">
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
	<script>
		$(function(){
			// ID 유효성 검사 및 중복확인 (keyup 이벤트)
			$('#id').keyup(function(){
				let id = $(this).val().trim();
				
				// 최소 길이 검사
				if(id.length < 3){
					$('#idConfirmResult').html('<b style="color:red;">아이디는 3글자 이상 입력하세요</b>');
					$(this).data('valid', false);
					return;
				}
				
				// AJAX 중복 확인
				$.ajax({
					url: 'idConfirmNonExists.html',
					type: 'GET',
					data: {id: id},
					dataType: 'html',
					success: function(response){
						$('#idConfirmResult').html(response);
						// 응답에 "사용가능" 텍스트가 있으면 유효한 것으로 간주
						if(response.includes('사용가능') || response.includes('사용 가능')){
							$('#id').data('valid', true);
						} else {
							$('#id').data('valid', false);
						}
					},
					error: function(xhr){
						$('#idConfirmResult').html('<b style="color:red;">중복 확인 중 오류 발생</b>');
						$('#id').data('valid', false);
					}
				});
			});
			
			// 비밀번호 일치 검사 (keyup 이벤트)
			$('#pw, #pwChk').keyup(function(){
				let pw = $('#pw').val();
				let pwChk = $('#pwChk').val();
				
				if(!pw && !pwChk){
					$('#pwChkResult').html('&nbsp;');
					$('#pw').data('valid', false);
				} else if(pw === pwChk){
					$('#pwChkResult').html('<b style="color:green;">비밀번호가 일치합니다</b>');
					$('#pw').data('valid', true);
				} else {
					$('#pwChkResult').html('<b style="color:red;">비밀번호가 일치하지 않습니다</b>');
					$('#pw').data('valid', false);
				}
			});
			
			// 폼 제출 시 유효성 검사
			$('form').submit(function(e){
				// ID 검사
				let idValid = $('#id').data('valid');
				if(!idValid){
					alert('아이디를 확인하세요. (3글자 이상, 중복불가)');
					$('#id').focus();
					return false;
				}
				
				// 비밀번호 검사
				let pwValid = $('#pw').data('valid');
				if(!pwValid){
					alert('비밀번호가 일치하지 않습니다.');
					$('#pw').focus();
					return false;
				}
				
				// 이름 검사
				if(!$('#name').val().trim()){
					alert('이름을 입력하세요.');
					$('#name').focus();
					return false;
				}
				
				return true;
			});
			
			// 로그인 버튼 클릭 시 이동
			$('.joinBtn_style[value="로그인"]').click(function(){
				window.location.href = 'login.html'; // 로그인 페이지 경로 설정
			});
		});
	</script>
</head>
<body>
	<div id="joinForm_wrap">
		<form action="joinProcess.html" method="post">
			<div id="join_title">회원가입</div>
			<table>
				<tr>
					<th><label for="id">아이디</label></th>
					<td>
						<input type="text" name="id" id="id" required autocomplete="off">
						<div id="idConfirmResult"> &nbsp; </div>
					</td>
				</tr>
				<tr>
					<th><label for="pw">비밀번호</label></th>
					<td><input type="password" name="pw" id="pw" required></td>
				</tr>
				<tr>
					<th><label for="pwChk">비밀번호확인</label></th>
					<td>
						<input type="password" name="pwChk" id="pwChk" required>
						<div id="pwChkResult"> &nbsp; </div>
					</td>
				</tr>
				<tr>
					<th><label for="name">이름</label></th>
					<td><input type="text" name="name" id="name" required></td>
				</tr>
				<tr>
					<th>생년월일</th>
					<td><input type="date" name="birth" autocomplete="off"></td>
				</tr>
				<tr>
					<td colspan="2">
						<input type="submit" value="가입하기" class="joinBtn_style">
						<input type="reset" value="다시하기" class="joinBtn_style">
						<input type="button" value="로그인" class="joinBtn_style">
					</td>
				</tr>
			</table>
		</form>
	</div>
</body>
</html>